name: Congressional Trading Scanner + Strategies

on:
  schedule:
    - cron: '0 14 * * *'  # 9am EST
    - cron: '0 22 * * *'  # 5pm EST
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  scan-and-strategies:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: pip install -r requirements.txt
    
    # ORIGINAL SCANNER - Detect new trades
    - name: Run congressional scanner
      env:
        USE_SAMPLE_DATA: 'false'
      run: python congressional_scanner.py
    
    - name: Update performance tracking
      continue-on-error: true
      run: python performance_tracker.py
    
    # NEW STRATEGIES - Build portfolios
    - name: Run premium strategies
      continue-on-error: true
      run: python run_all_strategies.py
    
    # ENHANCED DISCORD ALERTS - With portfolio context
    - name: Send enhanced alerts
      if: always()
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: python discord_alerts.py
    
    - name: Send strategy alerts
      if: always()
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: python strategy_discord_alerts.py
    
    # SAVE ALL RESULTS
    - name: Commit and push results
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add signals.json signal_history.json *_portfolio.json || true
        git diff --quiet && git diff --staged --quiet || git commit -m "Update signals and portfolios - $(date)"
        git push || true
    
    # UPLOAD ARTIFACTS (v4!)
    - name: Upload artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: trading-data
        path: |
          signals.json
          signal_history.json
          congress_buys_portfolio.json
          dan_meuser_portfolio.json
          blended_portfolio.json
        retention-days: 90
```

5. Commit message: `Update workflow for strategies and enhanced alerts`
6. Click **"Commit changes"**

---

## ğŸ¯ STEP 4: Verify Everything is Uploaded

### Check Your Repo Has These Files:

**Original files (should already exist):**
- âœ… congressional_scanner.py
- âœ… performance_tracker.py
- âœ… run_pipeline.py
- âœ… config.json
- âœ… requirements.txt
- âœ… .gitignore
- âœ… .env.example

**NEW files (you just added):**
- âœ… congress_buys_strategy.py
- âœ… dan_meuser_strategy.py
- âœ… strategy_analyzer.py
- âœ… strategy_discord_alerts.py
- âœ… run_all_strategies.py

**Updated files:**
- âœ… discord_alerts.py (now enhanced)
- âœ… .github/workflows/scanner.yml (now includes strategies)

**Total: Should have 17 files**

---

## ğŸ¯ STEP 5: Test the Workflow

1. Go to **"Actions"** tab
2. Click **"Congressional Trading Scanner + Strategies"**
3. Click **"Run workflow"** button (right side)
4. Keep "Branch: main" selected
5. Click green **"Run workflow"** button

### Watch It Run:

You should see these steps execute:
1. âœ… Checkout code
2. âœ… Set up Python
3. âœ… Install dependencies
4. âœ… Run congressional scanner
5. âœ… Update performance tracking
6. âœ… Run premium strategies â† NEW!
7. âœ… Send enhanced alerts â† ENHANCED!
8. âœ… Send strategy alerts â† NEW!
9. âœ… Commit and push results
10. âœ… Upload artifacts

**Takes ~2-3 minutes**

---

## ğŸ¯ STEP 6: Check Discord Alerts

### You Should Receive (in your Discord):

**From Scanner (Enhanced):**
```
ğŸš¨ Congressional Trading Alert
Found X high-priority signals

â­ TOP PERFORMER: Nancy Pelosi purchase NVDA
Ticker: NVDA
Amount: $250,000

ğŸ“Š Nancy Pelosi's Current Portfolio:
ğŸ”¥ 1. NVDA - 35% ($1,750,000)
   2. TSLA - 30% ($1,500,000)
   3. GOOGL - 20% ($1,000,000)
   ...

Portfolio Stats: 23 positions | $5,000,000
```

**From Strategies:**
```
ğŸ“Š Congress Buys Strategy Update
ğŸ’¼ Portfolio: 47 positions
ğŸ’° Total: $8,450,000

ğŸ† Dan Meuser Portfolio Update
ğŸ“ˆ All-Time Return: +735.85%
ğŸ’¼ Current: 23 positions

ğŸ¯ Blended Portfolio Strategy
